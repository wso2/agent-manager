// Code generated by Wire. DO NOT EDIT.

//go:generate go run -mod=mod github.com/google/wire/cmd/wire
//go:build !wireinject
// +build !wireinject

package wiring

import (
	"log/slog"

	"github.com/google/wire"
	"gorm.io/gorm"

	auth2 "github.com/wso2/ai-agent-management-platform/agent-manager-service/clients/apiplatformsvc/auth"
	client2 "github.com/wso2/ai-agent-management-platform/agent-manager-service/clients/apiplatformsvc/client"
	"github.com/wso2/ai-agent-management-platform/agent-manager-service/clients/observabilitysvc"
	"github.com/wso2/ai-agent-management-platform/agent-manager-service/clients/openchoreosvc/auth"
	"github.com/wso2/ai-agent-management-platform/agent-manager-service/clients/openchoreosvc/client"
	"github.com/wso2/ai-agent-management-platform/agent-manager-service/clients/traceobserversvc"
	"github.com/wso2/ai-agent-management-platform/agent-manager-service/config"
	"github.com/wso2/ai-agent-management-platform/agent-manager-service/controllers"
	"github.com/wso2/ai-agent-management-platform/agent-manager-service/middleware/jwtassertion"
	"github.com/wso2/ai-agent-management-platform/agent-manager-service/services"
)

// Injectors from wire.go:

// InitializeAppParams wires up all application dependencies
func InitializeAppParams(cfg *config.Config, db *gorm.DB) (*AppParams, error) {
	configConfig := ProvideConfigFromPtr(cfg)
	middleware := ProvideAuthMiddleware(configConfig)
	logger := ProvideLogger()
	authProvider := ProvideOCAuthProvider(configConfig)
	openChoreoClient, err := ProvideOCClient(configConfig, authProvider)
	if err != nil {
		return nil, err
	}
	observabilitySvcClient, err := ProvideObservabilitySvcClient(configConfig, authProvider)
	if err != nil {
		return nil, err
	}
	repositoryService := services.NewRepositoryService()
	jwtSigningConfig := ProvideJWTSigningConfig(configConfig)
	agentTokenManagerService, err := services.NewAgentTokenManagerService(openChoreoClient, jwtSigningConfig, logger)
	if err != nil {
		return nil, err
	}
	agentManagerService := services.NewAgentManagerService(openChoreoClient, observabilitySvcClient, repositoryService, agentTokenManagerService, logger)
	agentController := controllers.NewAgentController(agentManagerService)
	infraResourceManager := services.NewInfraResourceManager(openChoreoClient, logger)
	infraResourceController := controllers.NewInfraResourceController(infraResourceManager)
	traceObserverClient := traceobserversvc.NewTraceObserverClient()
	observabilityManagerService := services.NewObservabilityManager(traceObserverClient, openChoreoClient, logger)
	observabilityController := controllers.NewObservabilityController(observabilityManagerService)
	agentTokenController := controllers.NewAgentTokenController(agentTokenManagerService)
	repositoryController := controllers.NewRepositoryController(repositoryService)
	clientAuthProvider := ProvideAPIPlatformAuthProvider(configConfig)
	clientConfig := ProvideAPIPlatformConfig(configConfig, clientAuthProvider)
	apiPlatformClient := ProvideAPIPlatformClient(clientConfig)
	environmentService := services.NewEnvironmentService(logger, apiPlatformClient, openChoreoClient)
	environmentController := controllers.NewEnvironmentController(environmentService)
	gatewayController := controllers.NewGatewayController(apiPlatformClient, db)
	appParams := &AppParams{
		AuthMiddleware:          middleware,
		Logger:                  logger,
		AgentController:         agentController,
		InfraResourceController: infraResourceController,
		ObservabilityController: observabilityController,
		AgentTokenController:    agentTokenController,
		RepositoryController:    repositoryController,
		EnvironmentController:   environmentController,
		GatewayController:       gatewayController,
		APIPlatformClient:       apiPlatformClient,
		DB:                      db,
	}
	return appParams, nil
}

// InitializeTestAppParamsWithClientMocks wires up application dependencies with test mocks
func InitializeTestAppParamsWithClientMocks(cfg *config.Config, db *gorm.DB, authMiddleware jwtassertion.Middleware, testClients TestClients) (*AppParams, error) {
	logger := ProvideLogger()
	openChoreoClient := ProvideTestOpenChoreoClient(testClients)
	observabilitySvcClient := ProvideTestObservabilitySvcClient(testClients)
	repositoryService := services.NewRepositoryService()
	configConfig := ProvideConfigFromPtr(cfg)
	jwtSigningConfig := ProvideJWTSigningConfig(configConfig)
	agentTokenManagerService, err := services.NewAgentTokenManagerService(openChoreoClient, jwtSigningConfig, logger)
	if err != nil {
		return nil, err
	}
	agentManagerService := services.NewAgentManagerService(openChoreoClient, observabilitySvcClient, repositoryService, agentTokenManagerService, logger)
	agentController := controllers.NewAgentController(agentManagerService)
	infraResourceManager := services.NewInfraResourceManager(openChoreoClient, logger)
	infraResourceController := controllers.NewInfraResourceController(infraResourceManager)
	traceObserverClient := ProvideTestTraceObserverClient(testClients)
	observabilityManagerService := services.NewObservabilityManager(traceObserverClient, openChoreoClient, logger)
	observabilityController := controllers.NewObservabilityController(observabilityManagerService)
	agentTokenController := controllers.NewAgentTokenController(agentTokenManagerService)
	repositoryController := controllers.NewRepositoryController(repositoryService)
	apiPlatformClient := ProvideTestAPIPlatformClient(testClients)
	environmentService := services.NewEnvironmentService(logger, apiPlatformClient, openChoreoClient)
	environmentController := controllers.NewEnvironmentController(environmentService)
	gatewayController := controllers.NewGatewayController(apiPlatformClient, db)
	appParams := &AppParams{
		AuthMiddleware:          authMiddleware,
		Logger:                  logger,
		AgentController:         agentController,
		InfraResourceController: infraResourceController,
		ObservabilityController: observabilityController,
		AgentTokenController:    agentTokenController,
		RepositoryController:    repositoryController,
		EnvironmentController:   environmentController,
		GatewayController:       gatewayController,
		APIPlatformClient:       apiPlatformClient,
		DB:                      db,
	}
	return appParams, nil
}

// wire.go:

// Provider sets
var configProviderSet = wire.NewSet(
	ProvideConfigFromPtr,
)

var clientProviderSet = wire.NewSet(
	ProvideObservabilitySvcClient, traceobserversvc.NewTraceObserverClient, ProvideOCAuthProvider,
	ProvideOCClient,
	ProvideAPIPlatformAuthProvider,
	ProvideAPIPlatformConfig,
	ProvideAPIPlatformClient,
)

var serviceProviderSet = wire.NewSet(services.NewAgentManagerService, services.NewInfraResourceManager, services.NewObservabilityManager, services.NewAgentTokenManagerService, services.NewRepositoryService, services.NewEnvironmentService)

var controllerProviderSet = wire.NewSet(controllers.NewAgentController, controllers.NewInfraResourceController, controllers.NewObservabilityController, controllers.NewAgentTokenController, controllers.NewRepositoryController, controllers.NewEnvironmentController, controllers.NewGatewayController)

var testClientProviderSet = wire.NewSet(
	ProvideTestOpenChoreoClient,
	ProvideTestObservabilitySvcClient,
	ProvideTestTraceObserverClient,
	ProvideTestAPIPlatformClient,
)

// ProvideLogger provides the configured slog.Logger instance
func ProvideLogger() *slog.Logger {
	return slog.Default()
}

// ProvideOCAuthProvider creates the OpenChoreo auth provider using IDP config
func ProvideOCAuthProvider(cfg config.Config) client.AuthProvider {
	return auth.NewAuthProvider(auth.Config{
		TokenURL:     cfg.IDP.TokenURL,
		ClientID:     cfg.IDP.ClientID,
		ClientSecret: cfg.IDP.ClientSecret,
	})
}

// ProvideOCClient creates the OpenChoreo client
func ProvideOCClient(cfg config.Config, authProvider client.AuthProvider) (client.OpenChoreoClient, error) {
	return client.NewOpenChoreoClient(&client.Config{
		BaseURL:      cfg.OpenChoreo.BaseURL,
		AuthProvider: authProvider,
	})
}

// ProvideObservabilitySvcClient creates the observability service client
func ProvideObservabilitySvcClient(cfg config.Config, authProvider client.AuthProvider) (observabilitysvc.ObservabilitySvcClient, error) {
	return observabilitysvc.NewObservabilitySvcClient(&observabilitysvc.Config{
		BaseURL:      cfg.Observer.URL,
		AuthProvider: authProvider,
	})
}

var loggerProviderSet = wire.NewSet(
	ProvideLogger,
)

// ProvideAPIPlatformAuthProvider creates an auth provider for API Platform
func ProvideAPIPlatformAuthProvider(cfg config.Config) client2.AuthProvider {

	if cfg.IDP.TokenURL != "" && cfg.IDP.ClientID != "" && cfg.IDP.ClientSecret != "" {
		return auth2.NewAuthProvider(auth2.Config{
			TokenURL:     cfg.IDP.TokenURL,
			ClientID:     cfg.IDP.ClientID,
			ClientSecret: cfg.IDP.ClientSecret,
		})
	}
	return nil
}

// ProvideAPIPlatformConfig extracts API Platform configuration from config
func ProvideAPIPlatformConfig(cfg config.Config, authProvider client2.AuthProvider) *client2.Config {
	baseUrl := ""
	if cfg.APIPlatform.Enable {
		baseUrl = cfg.APIPlatform.BaseURL
	}
	return &client2.Config{
		BaseURL:      baseUrl,
		AuthProvider: authProvider,
	}
}

// ProvideAPIPlatformClient creates a new API Platform client
// Returns nil if the client cannot be created (will be checked at runtime)
func ProvideAPIPlatformClient(cfg *client2.Config) client2.APIPlatformClient {
	if cfg.BaseURL == "" || cfg.AuthProvider == nil {

		return nil
	}

	apiPlatformClient, err := client2.NewAPIPlatformClient(cfg)
	if err != nil {
		slog.Error("Failed to create API Platform client", "error", err)
		return nil
	}
	return apiPlatformClient
}

// Test client providers
func ProvideTestOpenChoreoClient(testClients TestClients) client.OpenChoreoClient {
	return testClients.OpenChoreoClient
}

func ProvideTestObservabilitySvcClient(testClients TestClients) observabilitysvc.ObservabilitySvcClient {
	return testClients.ObservabilitySvcClient
}

func ProvideTestTraceObserverClient(testClients TestClients) traceobserversvc.TraceObserverClient {
	return testClients.TraceObserverClient
}

func ProvideTestAPIPlatformClient(testClients TestClients) client2.APIPlatformClient {
	return testClients.APIPlatformClient
}
