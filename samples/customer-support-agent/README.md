# Agent Service
_Generated by AI_

This project implements a simple agent service with a FastAPI endpoint that accepts POST requests at `/invocations` and forwards them to the agent runtime

Agent is taken from: https://github.com/langchain-ai/langgraph/blob/main/docs/docs/tutorials/customer-support/customer-support.ipynb

## Requirements

- Python 3.10+ (project uses Python 3.13 bytecode in the workspace but 3.10+ is recommended)
- Install dependencies from `requirements.txt`:

```bash
pip install -r requirements.txt
```

## Configuration

The service requires two API keys (set these as environment variables or in a `.env` file in the project root):

- `OPENAI_API_KEY` - your OpenAI API key
- `TRIVIY_API_KEY` - your Triviy API key

Example `.env` file:

```
OPENAI_API_KEY=sk-...
TRIVIY_API_KEY=triviy-...
```

The project loads environment variables using `python-dotenv` in `app.py`.

## Initialize the database

Before starting the service, create and initialize the SQLite database using the provided setup script:

```bash
python setup/db.py
```

This will create the necessary database file(s) (for example `travel2.sqlite`) used by the project's tools.

## Running the FastAPI server

There are two ways to run the FastAPI app depending on the module that exposes the `app` instance:

- Run with `uvicorn` (recommended for development):

```bash
uvicorn app:app --reload
```

This starts the service on the default `http://127.0.0.1:8000`.

- Alternatively, if you use `main.py` as the entrypoint, run:

```bash
uvicorn main:app --reload
```

If you prefer launching the app directly from Python (less common), make sure the file contains a runnable ASGI entrypoint.

## Endpoint

POST /invocations

- Content-Type: `application/json`
- Payload shape (example):

```json
{
  "thread_id": 123,
  "passenger_id": "3442 587242",
  "question": "What is my flight status?"
}
```

Example curl request:

```bash
curl -X POST http://localhost:8000/invocations \
  -H "Content-Type: application/json" \
  -d '{"thread_id": 123, "passenger_id": "3442 587242", "question": "What is my flight status?"}'
```

## Notes & Troubleshooting

- Make sure your virtual environment is activated and `requirements.txt` packages are installed.
- If you see import errors related to `agent` or `db_utils`, verify that the project root is in `PYTHONPATH` (running `uvicorn` from the project root normally works).
- The `app.py` file imports `create_agent` from `agent.agent`. If the agent runtime requires additional configuration (for example, access to the APIs listed above), set those environment variables before starting the server.

## Next steps / Improvements

- Add automated tests for the `/invocations` endpoint.
- Add a small healthcheck endpoint (e.g., `GET /health`) that verifies database connectivity and required API keys.
