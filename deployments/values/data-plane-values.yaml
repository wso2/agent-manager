# OpenChoreo Data Plane Values
# Reference: https://openchoreo.dev/docs/getting-started/try-it-out/on-self-hosted-kubernetes/

# Gateway configuration
gateway:
  httpPort: 19080
  httpsPort: 19443
  envoy:
    # Required for k3d/Docker Desktop
    mountTmpVolume: true

# External Secrets Operator
external-secrets:
  enabled: true

# API Platform (APIM integration)
api-platform:
  enabled: true
  gateway:
    helm:
      chartName: "oci://ghcr.io/wso2/api-platform/helm-charts/gateway"
    values:
      gateway:
        config:
          policy_configurations:
            JWTAuth_v010:
              KeyManagers:
                - name: AgentManagerService
                  issuer: agent-manager-service
                  jwks:
                    remote:
                      uri: http://host.docker.internal:9000/auth/external/jwks.json
                      skipTlsVerify: true
              JwksCacheTtl: "5m"
              JwksFetchTimeout: "5s"
              JwksFetchRetryCount: 3
              JwksFetchRetryInterval: "2s"
              AllowedAlgorithms:
                - RS256
                - ES256
              Leeway: "30s"
              AuthHeaderScheme: ""
              HeaderName: x-amp-api-key
              OnFailureStatusCode: 401
              ErrorMessageFormat: json
              ErrorMessage: "Authentication failed."
              ValidateIssuer: true
